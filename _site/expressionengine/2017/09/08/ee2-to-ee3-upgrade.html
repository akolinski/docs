<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700|Merriweather+Sans" rel="stylesheet">
  <link href="/docs/assets/main.css" rel="stylesheet">
  <link rel="alternate" type="application/rss+xml" title="Docs" href="/docs/feed.xml">
  
</head>

  <body>
    <header class="site-header mb-5 pt-4 pb-4" role="banner">
  <div class="container">
    <div class="row justify-content-md-center">
      <div class="col-4">
        
        
        <a class="site-title" href="/docs/">Docs</a>
      </div>
      <div class="col-5">
        
          <nav class="site-nav float-right">
            <div class="trigger">
              
                
                
                <a class="page-link" href="/docs/about/">About</a>
                
              
                
                
              
                
                
              
                
                
              
            </div>
          </nav>
        
      </div>
    </div>
  </div>
</header>

    <main class="page-content" aria-label="Content">
        <div class="container">
  <div class="row justify-content-md-center">
    <div class="col-md-9">
      <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
        <header class="post-header">
          <h1 class="post-title mb-5" itemprop="name headline">EE2 to EE3 upgrade</h1>
          <p class="post-meta">
            <time datetime="2017-09-08T10:28:48+10:00" itemprop="datePublished">
              
              Sep 8, 2017
            </time>
            </p>
        </header>
        <div class="post-content" itemprop="articleBody">
          <blockquote class="blockquote">
Okay lets start upgrading EE2 to EE3.
</blockquote>

<p>Currently we have two instances running.</p>

<ol>
  <li>in the public folder we have our old EE2 instance running</li>
  <li>in the ee3 folder we have a fresh install of ee3 for testing purposes</li>
  <li>to run the upgrade and then revert back duplicate the public folder and rename to public_before_upgrade and take a dump of the db.</li>
</ol>

<p>You are now in a safe place.</p>

<h2 id="ee2-instance">EE2 instance</h2>

<ul>
  <li>Put current EE2 instance into a new vagrant box with current database.</li>
  <li>Libraries / core / Environment.php throwing errors</li>
</ul>

<p>We had to change the path in these files</p>

<p>public/libraries/core/Environment.php
modified:   public/libraries/core/exception/ArgumentException.php
modified:   public/system/expressionengine/config/config.php
modified:   public/system/expressionengine/config/database.php
modified:   public/system/expressionengine/third_party/ep_better_workflow/libraries/ep_status_transition.php</p>

<p>from</p>

<div class="highlighter-rouge"><pre class="highlight"><code>require_once ('core/Environment.php');
</code></pre>
</div>

<p>to</p>

<div class="highlighter-rouge"><pre class="highlight"><code>require_once ('libraries/core/Environment.php');
</code></pre>
</div>

<h2 id="edit-configphp">Edit config.php</h2>

<p>Update the stash_static_basepath &amp;&amp; stash_file_basepath in config.php</p>

<p>from</p>

<div class="highlighter-rouge"><pre class="highlight"><code>/usr/local/www-shared/ee-anon/assets/templates/stash-cache/';
</code></pre>
</div>

<p>to</p>

<div class="highlighter-rouge"><pre class="highlight"><code>assets/templates/stash-cache/
</code></pre>
</div>

<h2 id="so-we-are-going-to-rewrite-this-so-that-its-super-simple">So we are going to rewrite this so that it’s super simple.</h2>

<h2 id="vagrant-box">Vagrant box</h2>

<p>Create a new virtual host.</p>

<p>Sites available show the conf.
Sites enabled are sim links that enable the sites available.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>vagrant@scotchbox:~$ sudo su
root@scotchbox:/home/vagrant# cd /etc/apache2/
root@scotchbox:/etc/apache2# ll
drwxr-xr-x   2 root root  4096 Nov  3  2015 sites-available/
drwxr-xr-x   2 root root  4096 Jul 10  2015 sites-enabled/
</code></pre>
</div>

<p>You need to copy out this files if you want to be able to destroy these newly created scripts or setup a provising script in order to get it to work.</p>

<h2 id="upgrading-from-expressionengine-2-to-expressionengine3">Upgrading from ExpressionEngine 2 to ExpressionEngine3</h2>

<p>When we are ready we need to copy files from EE2 old vm to this current EE2 (public folder). So we have the latest codebase and ensure that the files are not being tampered with. Once in place we have a few of things to do.</p>

<blockquote>
  <p>Backup the current EE2 database and codebase.</p>
</blockquote>

<h3 id="1-uninstall-these-modules-and-delete-folders">1. Uninstall these modules and delete folders</h3>

<p>I think this step is only needed if we actually bring files from the EE2 instance currently on our old VM’s to this new EE2 instance. This is because currently we cannot remove ANON Workflow from the current website.</p>

<ul>
  <li>ANON Workflow</li>
  <li>NSM Live Look</li>
  <li>Sitemap</li>
  <li>
    <p>Supersearch</p>
  </li>
  <li>Make sure that any other modules, plugins, accessories, extensions and fieldtypes aren’t included!</li>
</ul>

<h3 id="2-follow-steps-from-ee-docs">2. Follow steps from EE docs</h3>

<p>Note * In the documentation where they recommend “putting ExpressionEngine 3 compatible third-party add-ons into the system/user/addons/ directory now.” Be sure to move the addons themes folders as well.</p>

<p><a href="https://docs.expressionengine.com/v3/installation/upgrade_from_2.x.html">Follow the steps from 1 to point 6</a></p>

<h3 id="3-set-permissions">3. Set permissions</h3>

<p>chmod 777 system/user/config/config.php
chmod 777 system/user/cache/
chmod 777 system/user/templates/</p>

<p>Boom, we should now have EE3 running.</p>

<h3 id="4-after-upgrade-can-we-do-this-before-the-upgrade-does-it-even-matter">4. After upgrade (Can we do this before the upgrade? Does it even matter?)</h3>

<ol>
  <li>Delete all calls to ep_better_workflow in exp_extensions table</li>
  <li>Delete all calls to Nsm_live_look_ext / dummy_hook in exp_extensions table</li>
  <li>Delete all calls to Absolute_total_results_ext in exp_extensions table</li>
  <li>Delete all exp_ep.. tables</li>
  <li>Delete all exp_super_search.. tables</li>
  <li>Delete exp_sitemap table ? TEST</li>
  <li>Delete exp_proform tables ?  TEST</li>
  <li>Delete exp_nsm tables ? TEST</li>
  <li>Delete exp_freeform tables ? TEST</li>
  <li>Remove Ep_better_workflow rows from exp_actions table</li>
  <li>Remove Super_search row from exp_actions table</li>
  <li>Open exp_modules and delete any references to modules that have been already uninstalled</li>
  <li>Install all the plugins that need to be installed. Previous version of EE had plugin just appear we now need to actually click install.</li>
  <li>To be removed ‘parent_is_bwf_draft’ from <code class="highlighter-rouge">exp_relationships</code> for publisher to be able to install.</li>
</ol>


        </div>
        
      </article>
    </div>
  </div>
</div>
    </main>
    <footer class="site-footer mt-5 pt-4 pb-4">
  <div class="container">

    <div class="row justify-content-md-center">

      <div class="col-md-4">
        <ul class="list-unstyled">
          <li>
            
              Adam Kolinski
            
            </li>
            
            <li><a href="mailto:info@makeaweb.com.au">info@makeaweb.com.au</a></li>
            
        </ul>
      </div>

      <div class="col-md-5">
        <ul class="list-unstyled">
          
          <li>
            <a href="https://github.com/akolinski"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">akolinski</span></a>

          </li>
          
          
          <li>
            <a href="https://twitter.com/MAKEAWEB_"><span class="icon icon--twitter"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">MAKEAWEB_</span></a>

          </li>
          
        </ul>
      </div>

    </div>

    <div class="row justify-content-md-center">
      <div class="col-md-9">
        <p>Free user documentation, research, tips, code snippets and templates.
</p>
      </div>
    </div>


  </div>
</footer>

  </body>
</html>